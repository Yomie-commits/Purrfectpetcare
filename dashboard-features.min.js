// FAB click opens Quick Actions modal document.addEventListener('DOMContentLoaded', function () { const fab = document.getElementById('fab'); if (fab) { fab.addEventListener('click', function () { openModal('quick-actions-modal'); }); fab.addEventListener('keydown', function (e) { if (e.key === 'Enter' || e.key === ' ') { openModal('quick-actions-modal'); } }); } }); // Modal open/close helpers function openModal(id) { const modal = document.getElementById(id); if (modal) { modal.style.display = 'flex'; // Trap focus trapFocus(modal); } } function closeModal(id) { const modal = document.getElementById(id); if (modal) { modal.style.display = 'none'; } } // Trap focus in modal for accessibility function trapFocus(modal) { const focusableEls = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'); const firstEl = focusableEls[0]; const lastEl = focusableEls[focusableEls.length - 1]; modal.addEventListener('keydown', function(e) { if (e.key === 'Tab') { if (e.shiftKey) { if (document.activeElement === firstEl) { e.preventDefault(); lastEl.focus(); } } else { if (document.activeElement === lastEl) { e.preventDefault(); firstEl.focus(); } } } if (e.key === 'Escape') { modal.style.display = 'none'; } }); setTimeout(() => firstEl && firstEl.focus(), 100); } // Profile modal logic function openProfileModal() { const profileContent = document.getElementById('profile-content'); if (profileContent) { // Example: Load user info from localStorage or API const name = localStorage.getItem('petCareUserName') || 'John Peterson'; const email = localStorage.getItem('petCareUserEmail') || 'john@example.com'; profileContent.innerHTML = `<p><strong>Name:</strong> ${name}</p><p><strong>Email:</strong> ${email}</p>`; } openModal('profile-modal'); } // Notifications modal logic function openNotificationsModal() { const notificationsList = document.getElementById('notifications-list'); if (notificationsList) { // Example: Load notifications from localStorage or API const notifications = JSON.parse(localStorage.getItem('petCareNotifications') || '[]'); if (notifications.length === 0) { notificationsList.innerHTML = '<li>No notifications.</li>'; } else { notificationsList.innerHTML = notifications.map(n => `<li>${n}</li>`).join(''); } } openModal('notifications-modal'); } // --- Real-Time Notifications Polling --- let lastNotificationCount = 0; function pollNotifications() { const userId = localStorage.getItem('petCareUserId'); if (!userId) return; fetch('notifications.php?action=fetch&user_id=' + encodeURIComponent(userId)) .then(res => res.json()) .then(data => { if (data.success && Array.isArray(data.data)) { const notifications = data.data; // Update modal const notificationsList = document.getElementById('notifications-list'); if (notificationsList) { if (notifications.length === 0) { notificationsList.innerHTML = '<li>No notifications.</li>'; } else { notificationsList.innerHTML = notifications.map(n => `<li${n.is_read == 0 ? ' style=\'font-weight:bold\'' : ''}>${n.message} <small>${new Date(n.created_at).toLocaleString()}</small></li>`).join(''); } } // Show badge if new notifications const unread = notifications.filter(n => n.is_read == 0).length; let badge = document.getElementById('notification-badge'); if (!badge) { badge = document.createElement('span'); badge.id = 'notification-badge'; badge.style = 'position:absolute;top:6px;right:6px;background:#e53935;color:#fff;border-radius:50%;padding:2px 7px;font-size:0.8rem;z-index:1200;'; const fab = document.getElementById('fab'); if (fab) fab.appendChild(badge); } badge.style.display = unread > 0 ? 'inline-block' : 'none'; badge.textContent = unread > 0 ? unread : ''; // Show toast for new notifications if (unread > lastNotificationCount) { showToast('You have new notifications!', 'info'); } lastNotificationCount = unread; } }); } setInterval(pollNotifications, 30000); document.addEventListener('DOMContentLoaded', pollNotifications);
